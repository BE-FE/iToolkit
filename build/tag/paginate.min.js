riot.tag("paginate",'<div onselectstart="return false" ondragstart="return false"> <div class="paginate"> <li onclick="{ goFirst }">«</li> <li onclick="{ goPrev }">‹</li> </div> <ul class="paginate"> <li each="{ pages }" onclick="{ parent.changePage }" class="{ active: parent.currentPage == page }">{ page }</li> </ul> <div class="paginate"> <li onclick="{ goNext }">›</li> <li onclick="{ goLast }">»</li> </div> <div class="paginate"> <form onsubmit="{ redirect }"> <span class="redirect" if="{ redirect }">跳转到<input name="page" riot-type={"number"} style="width: 40px;" min="1" max="{ pageCount }">页 </span> <span class="page-sum" if="{ showPageCount }"> 共<em>{ pageCount }</em>页 </span> <span class="item-sum" if="{ showItemCount }"> <em>{ count }</em>条 </span> <input type="submit" style="display: none;"> </form> </div> </div>',function(e){var a=this,t=a.root,n=a.opts.opts||a.opts;if(a.count=n.count||0,a.pagesize=n.pagesize||20,a.pageCount=n.pageCount||Math.ceil(a.count/a.pagesize)||1,a.currentPage=n.currentPage||1,a.url=n.url||"",a.showNumber=n.showNumber||5,a.redirect=n.redirect||!0,a.showPageCount=n.showPageCount||!0,a.showItemCount=n.showItemCount||!0,a.needInit=n.needInit||!1,t.addCount=function(e){{var t=a.count+e;a.pageCount}if(a.count=0>t?0:t,a.pageCount=Math.ceil(a.count/a.pagesize)||1,a.currentPage=a.currentPage>a.pageCount?a.pageCount:a.currentPage,a.pageCount<=a.showNumber){a.pages=[];for(var i=0;i<a.pageCount;i++)a.pages.push({page:i+1})}a.needInit&&n.callback(a.currentPage),a.pageChange(a.currentPage),a.update()},a.needInit&&n.callback(a.currentPage),a.pages=[],a.pageCount<a.showNumber+1)for(i=0;i<a.pageCount;i++)a.pages.push({page:i+1});else{for(i=0;i<a.showNumber;i++)a.pages.push({page:i+1});a.pages.push({page:"..."})}a.update(),this.goFirst=function(e){a.pageChange(1)}.bind(this),this.goPrev=function(e){a.currentPage>1&&a.pageChange(a.currentPage-1)}.bind(this),this.goNext=function(e){a.currentPage<a.pageCount&&a.pageChange(a.currentPage+1)}.bind(this),this.goLast=function(e){a.pageChange(a.pageCount)}.bind(this),this.redirect=function(e){var t=a.page.value;parseInt(t,10)&&parseInt(t,10)<a.pageCount+1&&a.pageChange(parseInt(t,10))}.bind(this),this.changePage=function(e){var t=e.item.page;return"string"==typeof t?!1:void a.pageChange(t)}.bind(this),a.pageChange=function(e){if(a.currentPage!=e&&(a.currentPage=e,n.callback(e)),a.currentPage>Math.ceil(a.showNumber/2)&&a.pageCount>a.showNumber){if(a.pages=[],a.pageCount-a.currentPage>2)var t=a.currentPage-Math.ceil(a.showNumber/2),g=a.currentPage+Math.floor(a.showNumber/2);else var g=a.pageCount,t=a.pageCount-a.showNumber;for(i=t;i<g;i++)a.pages.push({page:i+1}),a.update()}else if(a.currentPage<Math.ceil(a.showNumber/2)+1&&a.pageCount>a.showNumber){for(a.pages=[],i=0;i<a.showNumber;i++)a.pages.push({page:i+1});a.pages.push({page:"..."})}}});